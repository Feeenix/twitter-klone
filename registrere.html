<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registrer ny Bruker</title>
    <link rel="stylesheet" href="hoved.css">
</head>
<style>
    /* lokal stilark */

    .vanligKnapp {
        /* midtstilt med responsiv bredde */
        margin-left: auto;
        margin-right: auto;
        margin-bottom: 15px;
        width: 100%;
    }

    .container {
        margin-top: 15px;
        text-align: center;
        max-width: 300px;
    }

    .container a {
        text-align: justify;
    }
</style>

<body>
    <!-- TODO:
    Alt skal inn i en div som capper bredden til 300px og sentrerer innholdet.
    Bark-ikonet i øverst i midten.
    Tekst som sier "Registrer en ny bruker til Barker". kanskje h1 eller h2.
    En input for brukernavn.
    En input for passord.
    En input for gjenta passord.
    En knapp som sier "Lag Bruker". denne må bruke en event listener som sjekker om brukernavnet ikke finnes allerede og at passordene er like.
    en tekst som sier "Har du allerede en konto? Logg inn her". dette skal være en link til index.html
      -->


    <div class="container">
        <img src="bilder/BARK.png" height="50px" alt="bark icon">
        <h1>Registrer en ny bruker til Barker</h1>
        <p class="errorMessage"></p>
        <div class="inputfield">
            <label for="brukernavn">Nytt brukernavn</label>
            <input type="text" id="brukernavn" placeholder="">
        </div>
        <div class="inputfield">
            <label for="passord">Nytt Passord</label>
            <input type="password" id="passord" placeholder="">
        </div>
        <div class="inputfield">
            <label for="passord-repeat">Gjenta Passord</label>
            <input type="password" id="passord-repeat" placeholder="">
        </div>
        <button class="vanligKnapp" type="submit">Lag Bruker</button>
        <a href="index.html">Har du allerede en bruker? Logg inn her</a>
    </div>
</body>
<script src="javascript/lib.js"></script>
<script>
    // legger til event listeners
    let registrerKnapp = document.querySelector('button');
    registrerKnapp.addEventListener('click', registrer);

    let inputBrukernavn = document.querySelector('#brukernavn');
    let inputPassord = document.querySelector('#passord');
    let inputPassordRepeat = document.querySelector('#passord-repeat');

    inputBrukernavn.addEventListener('keyup', function (e) {
        if (e.key === 'Enter') {
            inputPassord.focus();
        }
    });

    inputPassord.addEventListener('keyup', function (e) {
        if (e.key === 'Enter') {
            inputPassordRepeat.focus();
        }
    });

    inputPassordRepeat.addEventListener('keyup', function (e) {
        if (e.key === 'Enter') {
            registrer();
        }
    });

    registrerKnapp.addEventListener('keyup', function (e) {
        if (e.key === 'Enter') {
            registrer();
        }
    });





    function registrer(e) {
        let brukernavnEl = document.querySelector('#brukernavn');
        let passordEl = document.querySelector('#passord');
        let passordRepeatEl = document.querySelector('#passord-repeat');

        let brukernavn = brukernavnEl.value;
        let passord = passordEl.value;
        let passordRepeat = passordRepeatEl.value;

        if (brukernavn.length === 0) {
            console.log('Du må skrive inn brukernavn');
            let errorMessage = document.querySelector('.errorMessage');
            errorMessage.innerHTML = 'Du må skrive inn brukernavn';
            brukernavnEl.focus();
            errorMessage.style.display = 'block';
            return
        }
        if (passord.length === 0) {
            console.log('Du må skrive inn passord');
            let errorMessage = document.querySelector('.errorMessage');
            errorMessage.innerHTML = 'Du må skrive inn passord';
            passordEl.focus();
            errorMessage.style.display = 'block';
            return
        }
        if (passordRepeat !== passord) {
            console.log('Passordene er ikke like');
            let errorMessage = document.querySelector('.errorMessage');
            errorMessage.innerHTML = 'Passordene er ikke like';
            passordRepeatEl.focus();
            errorMessage.style.display = 'block';
            return
        }
        if (brukernavn.length < 3 || brukernavn.length > 20) {
            console.log('Brukernavnet må være mellom 3 og 20 tegn');
            let errorMessage = document.querySelector('.errorMessage');
            errorMessage.innerHTML = 'Brukernavnet må være mellom 3 og 20 tegn';
            brukernavnEl.focus();
            errorMessage.style.display = 'block';
            return
        }
        if (passord.length < 6) {
            console.log('Passordet må være minst 6 tegn');
            let errorMessage = document.querySelector('.errorMessage');
            errorMessage.innerHTML = 'Passordet må være minst 6 tegn';
            passordEl.focus();
            errorMessage.style.display = 'block';
            return
        }
        if (brukernavnFinnes(brukernavn)) {
            console.log('Brukernavnet er opptatt');
            let errorMessage = document.querySelector('.errorMessage');
            errorMessage.innerHTML = 'Brukernavnet er allerede tatt, velg et annet';
            brukernavnEl.focus();
            errorMessage.style.display = 'block';
            return
        }


        lagNyBruker(brukernavn, passord);



        if (testBrukernavnOgPassord(brukernavn, passord)) { // kopiert kode fra index.html
            console.log('Du er logget inn');
            settInnloggetBruker(brukernavn);
            window.location.href = 'customize.html';
        } else {
            // ↓ dette burde aldri skje hvis alt er riktig
            console.log('Feil brukernavn eller passord');
            let errorMessage = document.querySelector('.errorMessage');
            errorMessage.innerHTML = 'Feil brukernavn eller passord';
            brukernavnEl.focus();

        }

    }

</script>

</html>