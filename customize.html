<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customize user</title>
    <link rel="stylesheet" href="hoved.css">
</head>
<style>
    .inputfield {
        display: flex;
        width: 300px;
        justify-content: center;
    }

    #midtkolonne {
        max-width: 1000px;
    }
</style>

<body>
    <!-- To do!
    Nettsiden skal ha konstant bredde hvis bredden på skjermen er større en 1200 px 
    .container gjør dette for oss
    vi skal dele opp .container i en venstre- og høyrekolonne der høyrekolonne tar størst plass
    venstrekolonne vil bli delt opp i 2 deler den ene er logo + meny. den andre delen er bruker sin profil
    Høyre kolonne vil bli delt opp i 2 deler den ene er størst og vil ligge mer mot midten av siden vi kaller denne Midtkolonne. den andre delen vil fungere som en sidebar hvor man kan søke etter bruker og kunen følge tilfeldige bruker som er valgt av programmet 
    Midtkolonnen vil bli delt opp i 2 deler overskift/tabs og den andre delen vil være en feed. -->



    <div class="container">
        <div class="hovedflex">
            <div id="venstrekolonne">
                <div id="meny">
                    <a href="home.html" id="logo" class="hiddenButton">
                        <img src="bilder/BARK.png" width="40" alt="BARK.png" class="logoIkon">
                    </a>
                    <div id="menyknapper">
                        <a href="home.html" class="hiddenButton genericButton" id="menyhjem">
                            <img src="bilder/home_hul.png" height="30" alt="">
                            <div class="buttonText">Hjem</div>
                        </a>


                        <a href="viewprofile.html?brukernavn=brukernavn" class="hiddenButton genericButton"
                            id="menyprofil">
                            <img src="bilder/profil_hul.png" height="30" alt="">
                            <div class="buttonText">Profil</div>
                        </a>
                        <a href="settings.html" class="hiddenButton genericButton" id="menyinnstillinger">
                            <img src="bilder/settings_hul.png" height="30" alt="">
                            <div class="buttonText">Innstillinger</div>
                        </a>

                    </div>

                </div>


            </div>
            <div id="hoyrekolonne">
                <div id="midtkolonne">
                    <div id="overskrift">
                        <div id="overskrifttekst">Velkommen til Barker</div>

                    </div>
                    <div id="feed">
                        <div id="setupProfile">

                            <div class="settingsheader" value="0">What do you want to be called?</div>
                            <div class="inputfield">

                                <input style="display: block;" type="text" class="inputText"
                                    placeholder="Håkon lærerson...">


                                <input id="uploadFile" style="display: none;" type="file" accept="image/*"
                                    class="inputFile">
                                <button style="display: none; width: fit-content;" class="vanligKnapp genericButton">Click to upload image</button>


                                <textarea style="display: none;" class="inputTextarea"
                                    placeholder="Write your bio..."></textarea>
                            </div>
                            <div class="imagePreview" style="display: none;">
                                <img src="" alt="100" width="150" height="150">
                            </div>
                            <div id="setupButtons">
                                <button class="vanligKnapp genericButton">Skip</button>
                                <button class="vanligKnapp genericButton">Next</button>

                            </div>
                        </div>

                    </div>

                </div>
                <!-- <div id="sidebar">

                    <div class="whotofollow">
                        <div class="whotofollowheader">Preview</div>
                        <div class="whotofollowbody">


                        </div>
                    </div>




                </div> -->

            </div>

        </div>


    </div>




</body>

<script src="javascript/lib.js"></script>
<script src="javascript/redirectHvisLoggetUt.js"></script>
<script src="javascript/urlbarHistory.js"></script>
<script>
    clearHistory();

    let knapper = document.querySelectorAll("#setupButtons>*")

    for (let i = 0; i < knapper.length; i++) {
        knapper[i].addEventListener("click", function () {
            nextPrompt(skip = (i != 1));
        })
    }

    let uploadFile = document.querySelector("#uploadFile")
    uploadFile.addEventListener("change", async function () {
        let file = this.files[0];
        if (file) {
            document.querySelector(".imagePreview").style.display = "block";
            let result = await readfile(file);
            document.querySelector(".imagePreview>img").src = result;
        }
        reader.readAsDataURL(file);
    })
    document.querySelector(".imagePreview>img").src = "";

    let uploadButton = document.querySelector(".inputfield>button");
    uploadButton.addEventListener("click", function () {
        document.querySelector("#uploadFile").click();
    })
    async function nextPrompt(skip = false) {
        let setupInputs = document.querySelectorAll(".inputfield>*"); // array med 3 inputs
        let setupHeader = document.querySelector(".settingsheader");

        let stage = Number(setupHeader.getAttribute("value"));

        let loggetInnBruker = hentInnloggetBrukerId();
        console.log(loggetInnBruker)
        let listeOverType = ["text", "file", "textarea", "file", "text"];
        let listeOverIndexer = [0, 1, 3, 1, 0];
        let listeOverNokler = ["displayName", "profileImage", "bio", "bannerImage", "location"];
        let listeOverSprml = ["What do you want to be called?", "What do you want your profile picture to be?", "What do you want your bio to be?", "What do you want your profile banner to be?", "What is your location?"]

        let nokkel = listeOverNokler[stage];
        let type = listeOverType[stage];

        if (!skip) {
            // lagre dataen
            let data = ""

            if (type != "file") {
                data = setupInputs[listeOverIndexer[stage]].value;
            } else {
                let File = setupInputs[listeOverIndexer[stage]].files[0];
                data = await readfile(File);
            }

            console.log(type, data)
            if (data.length > 0) {
                let objektTing = { [nokkel]: data }
                leggTilDataPaaBruker(loggetInnBruker, objektTing)
            }
        }

        setupInputs[listeOverIndexer[stage]].value = "";

        if (listeOverIndexer[stage] == 1) {
            setupInputs[listeOverIndexer[stage] + 1].style.display = "none";
            document.querySelector(".imagePreview").style.display = "none";
        } else {
            setupInputs[listeOverIndexer[stage]].style.display = "none";
        }
        stage++;
        if (stage == 1) {
            document.querySelector(".imagePreview>img").className = "profileImgCustomize";
        }
        if (stage == 2) {
            document.querySelector(".imagePreview>img").className = "bannerImgCustomize";
        }


        if (stage > 4) {
            // gå til home
            window.location.href = "viewprofile.html?brukernavn=" + loggetInnBruker;
        } else {
            // gå til neste prompt
            setupHeader.setAttribute("value", stage);
            setupHeader.innerHTML = listeOverSprml[stage];

            if (listeOverIndexer[stage] == 1) {
                setupInputs[listeOverIndexer[stage] + 1].style.display = "block";

                setupInputs[listeOverIndexer[stage] + 1].focus();
            } else {
                setupInputs[listeOverIndexer[stage]].style.display = "block";
                setupInputs[listeOverIndexer[stage]].focus();
            }
        }



        /* 
        Displayname
        0: What do you want to be called?
        Profile picture
        1: What do you want your profile picture to be?
        Bio
        2: What do you want your bio to be?
        Profile banner
        3: What do you want your profile banner to be?
        location
        4: What is your location?
        */

    }


    let menyprofil = document.querySelector("#menyprofil");
    menyprofil.href = "viewprofile.html?brukernavn=" + hentInnloggetBrukerId();
    menyprofil.addEventListener("click", function (event) {
        event.preventDefault();
        clearHistory();
        window.location.href = "viewprofile.html?brukernavn=" + hentInnloggetBrukerId();
    });

</script>

</html>