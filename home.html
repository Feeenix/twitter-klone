<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home page </title>
    <link rel="stylesheet" href="hoved.css">
</head>
<style>


</style>


<body>
    <!-- To do!
    Nettsiden skal ha konstant bredde hvis bredden på skjermen er større en 1200 px 
    .container gjør dette for oss
    vi skal dele opp .container i en venstre- og høyrekolonne der høyrekolonne tar størst plass
    venstrekolonne vil bli delt opp i 2 deler den ene er logo + meny. den andre delen er bruker sin profil
    Høyre kolonne vil bli delt opp i 2 deler den ene er størst og vil ligge mer mot midten av siden vi kaller denne Midtkolonne. den andre delen vil fungere som en sidebar hvor man kan søke etter bruker og kunen følge tilfeldige bruker som er valgt av programmet 
    Midtkolonnen vil bli delt opp i 2 deler overskift/tabs og den andre delen vil være en feed. -->



    <div class="container">
        <div class="hovedflex">
            <div id="venstrekolonne">
                <div id="meny">
                    <a href="home.html" id="logo" class="hiddenButton">
                        <img src="bilder/BARK.png" width="40" alt="BARK.png" class="logoIkon">
                    </a>
                    <div id="menyknapper">
                        <a href="home.html" class="boldText hiddenButton genericButton" id="menyhjem">
                            <img src="bilder/home.png" height="30" alt="">
                            <div class="buttonText">Hjem</div>
                        </a>

                        <a href="sok.html?query=" class="largeWidth hiddenButton genericButton" id="menysok">
                            <img src="bilder/search_hul.png" height="30" alt="">
                            <div class="buttonText">Søk</div>
                        </a>

                        <a href="viewprofile.html?brukernavn=brukernavn" class="hiddenButton genericButton"
                            id="menyprofil">
                            <img src="bilder/profil_hul.png" height="30" alt="">
                            <div class="buttonText">Profil</div>
                        </a>
                        <a href="settings.html" class="hiddenButton genericButton" id="menyinnstillinger">
                            <img src="bilder/settings_hul.png" height="30" alt="">
                            <div class="buttonText">Innstillinger</div>
                        </a>

                    </div>

                </div>
                <div class="profil">
                    <button class="profilknapp genericButton hiddenButton">

                        <div>
                            <img class="profilbilde"
                                src="https://cdn.discordapp.com/attachments/1095708777027739668/1096797766228918313/IT_logo.png"
                                alt="pfp" height="50" width="50">
                            <div class="mediumWidth profilnavn">
                                <div class="mediumWidth profilNavnNavn">Navn</div>
                                <div class="mediumWidth profilNavnId">@Brukernavn</div>
                            </div>



                        </div>
                        <div id="mediumWidth menyindikator">
                            <img src="bilder/tredots.png" width="30" height="30" alt="" class="mediumWidth">
                        </div>
                    </button>
                </div>
                <div id="popupLogout" tabindex="0">
                    <a href="viewprofile.html?brukernavn=brukernavn" id="popupViewProfile" tabindex="0"
                        class="genericButton hiddenButton">Profil</a>
                    <a href="settings.html" id="popupSettings" class="genericButton hiddenButton"
                        tabindex="0">Innstillinger</a>
                    <button id="popupLogoutButton" class="genericButton hiddenButton" tabindex="0"> Logg ut</button>
                </div>
            </div>
            <div id="hoyrekolonne">
                <div id="midtkolonne">
                    <div id="overskrift">
                        <div id="overskrifttekst">Home</div>
                        <div id="overskrifttabs">
                            <button id="overskriftfollowing" class="overskriftknapp hiddenButton">
                                <div>
                                    Following
                                    <div class="line"></div>
                                </div>
                            </button>
                            <button id="overskriftall" class="overskriftknapp hiddenButton">
                                <div>
                                    All
                                    <div class="line"></div>
                                </div>
                            </button>
                        </div>
                    </div>
                    <div id="feed">










                        <div class="tweet">
                            <div class="profilbildekolonne">
                                <img class="profilbilde"
                                    src="https://cdn.discordapp.com/attachments/1095708777027739668/1096797766228918313/IT_logo.png"
                                    alt="pfp" height="50" width="50">
                            </div>
                            <div class="tweetkolonne">
                                <div class="forfatterinfo">
                                    <div>Name Lastname</div>
                                    <div>@elonmusk</div>
                                    <div>14h</div>
                                </div>
                                <div class="tweettekst">
                                    I am a tweet
                                </div>
                                <!-- <img src="https://cdn.discordapp.com/attachments/1095708777027739668/1096797766228918313/IT_logo.png" alt="tweet image" class="tweetbilde"> -->

                                <div class="tweetknapper">

                                    <button title="trykk for å legge til en kommentar"
                                        class="tweetknappkommentar tweetknapp genericButton hiddenButton">
                                        <span title="10000">10.0k</span>
                                        <img src="bilder/comment_hul.png" height="20" alt="Kommentarer">
                                    </button>

                                    <button title="trykk for å retweete"
                                        class="tweetknappretweet tweetknapp genericButton hiddenButton">
                                        <span title="10000">10.0k</span>
                                        <img src="bilder/retweet_hul.png" height="20" alt="Retweets">

                                    </button>

                                    <button title="trykk for å like"
                                        class="tweetknapplikes tweetknapp genericButton hiddenButton">
                                        <span title="10000">10.0k</span>
                                        <img src="bilder/heart_hul.png" height="20" alt="Likes">

                                    </button>

                                    <button title="Views" class="tweetknappviews tweetknapp genericButton hidden">
                                        <span title="10000">10.0k</span>
                                        <img src="bilder/eye_hul.png" height="30" alt="Views">

                                    </button>
                                </div>
                            </div>
                        </div>



                    </div>


                    <a class="telefontweeting aatweetknapp" tabindex="0">
                        BARK
                        <!-- <img src="bilder/BARK.png" alt="tweetknapp" width="50" height="50"> -->
                    </a>
                    <a class="smallWidth fixedbunnhoyre aatweetknapp " tabindex="0">
                        BARK
                        <!-- <img src="bilder/BARK.png" alt="tweetknapp" width="50" height="50"> -->
                    </a>



                </div>
                <div id="sidebar">
                    <div id="sok">
                        <input type="text" placeholder="Search on the Bark web..." id="sokfelt"></input>
                        <div>
                            <button id="fjernQueryKnapp" class="hiddenButton">
                                <img src="bilder/clear.png" width="20" height="20" alt="fjernQueryKnapp">
                            </button>
                            <button id="sokknapp" class="hiddenButton">
                                <!-- når denne trykkes skal vi navigere til en ny side som ligner
                                 -->
                                <img src="bilder/search.png" width="25" height="25" alt="sokeknapp">
                            </button>
                        </div>
                    </div>
                    <div class="whotofollow">
                        <div class="whotofollowheader">Who to follow</div>
                        <div class="whotofollowbody">

                            <div class="whotofollowperson">

                                <a href="viewprofile.html?brukernavn=brukernavn" title="trykk for å se profilen" alt=""
                                    class="folgePerson hiddenButton">
                                    <div>
                                        <img class="profilbilde"
                                            src="https://cdn.discordapp.com/attachments/1095708777027739668/1096797766228918313/IT_logo.png"
                                            alt="pfp" height="50" width="50">
                                        <div class="profilnavn">
                                            <div class="profilNavnNavn">Navn</div>
                                            <div class="profilNavnId">@Brukernavn</div>
                                        </div>
                                    </div>
                                    <button class="follow vanligKnapp" title="trykk for å følge">Follow</button>
                                </a>

                            </div>
                            <div class="whotofollowperson">

                                <a href="viewprofile.html?brukernavn=brukernavn" title="trykk for å se profilen" alt=""
                                    class="folgePerson hiddenButton">
                                    <div>
                                        <img class="profilbilde"
                                            src="https://cdn.discordapp.com/attachments/1095708777027739668/1096797766228918313/IT_logo.png"
                                            alt="pfp" height="50" width="50">
                                        <div class="profilnavn">
                                            <div class="profilNavnNavn">Navn</div>
                                            <div class="profilNavnId">@Brukernavn</div>
                                        </div>
                                    </div>
                                    <button class="follow vanligKnapp" title="trykk for å følge">Follow</button>
                                </a>

                            </div>
                            <div class="whotofollowperson">

                                <a href="viewprofile.html?brukernavn=brukernavn" title="trykk for å se profilen" alt=""
                                    class="folgePerson hiddenButton">
                                    <div>
                                        <img class="profilbilde"
                                            src="https://cdn.discordapp.com/attachments/1095708777027739668/1096797766228918313/IT_logo.png"
                                            alt="pfp" height="50" width="50">
                                        <div class="profilnavn">
                                            <div class="profilNavnNavn">Navn</div>
                                            <div class="profilNavnId">@Brukernavn</div>
                                        </div>
                                    </div>
                                    <button class="follow vanligKnapp" title="trykk for å følge">Follow</button>
                                </a>

                            </div>
                            <div class="whotofollowperson">

                                <a href="viewprofile.html?brukernavn=brukernavn" title="trykk for å se profilen" alt=""
                                    class="folgePerson hiddenButton">
                                    <div>
                                        <img class="profilbilde"
                                            src="https://cdn.discordapp.com/attachments/1095708777027739668/1096797766228918313/IT_logo.png"
                                            alt="pfp" height="50" width="50">
                                        <div class="profilnavn">
                                            <div class="profilNavnNavn">Navn</div>
                                            <div class="profilNavnId">@Brukernavn</div>
                                        </div>
                                    </div>
                                    <button class="follow vanligKnapp" title="trykk for å følge">Follow</button>
                                </a>

                            </div>

                        </div>
                    </div>


                    <a class="bunnhoyre aatweetknapp " tabindex="0">
                        BARK
                        <!-- <img src="bilder/BARK.png" alt="tweetknapp" width="50" height="50"> -->
                    </a>

                </div>

            </div>

        </div>


    </div>




</body>

<script src="javascript/lib.js"></script>
<script src="javascript/redirectHvisLoggetUt.js"></script>
<script src="javascript/profilemenu.js"></script>
<script src="javascript/urlbarHistory.js"></script>
<script src="javascript/sokbar.js"></script>
<script src="javascript/barkKnapp.js"></script>
<script>
    clearHistory();
    leggTilHistory();

    let buttonLogout = document.querySelector("#popupLogoutButton");
    buttonLogout.addEventListener("click", loggUtBruker);

    let fjernQueryKnapp = document.querySelector("#fjernQueryKnapp");
    fjernQueryKnapp.addEventListener("click", clearSearch);

    function clearSearch() {
        let sokfeltEl = document.querySelector("#sokfelt");
        sokfeltEl.value = "";
        sokfeltEl.focus();
    }


    function search() {
        let sokfeltEl = document.querySelector("#sokfelt");
        let query = sokfeltEl.value;
        if (query.length > 0) {
            window.location.href = "search.html?query=" + query;
        }
    }




    let profil = document.querySelector(".profil > button");
    let popupElement = document.querySelector("#popupLogout");

    document.querySelector("#overskriftfollowing").addEventListener("focus", gjemPopup)
    popupElement.addEventListener("blur", gjemPopup);

    profil.addEventListener("focus", visPopup);

    profil.addEventListener("blur", gjemPopup);
    gjemPopup();
    async function gjemPopup() {
        await sleep(10);

        let elementer = document.querySelectorAll("#popupLogout > *, #popupLogout");
        let harFokus = false;
        for (let i = 0; i < elementer.length; i++) {
            if (elementer[i] == document.activeElement) {
                harFokus = true;
            }
        }
        if (harFokus) {
            return
        }

        console.log("gjemPopup");
        let popupLogout = document.querySelector("#popupLogout");
        popupLogout.style.display = "none";

    }
    function visPopup() {
        console.log("visPopup");
        let popupLogout = document.querySelector("#popupLogout");
        popupLogout.style.display = "block";
    }


    let menyprofil = document.querySelector("#menyprofil");
    menyprofil.href = "viewprofile.html?brukernavn=" + hentInnloggetBrukerId();
    menyprofil.addEventListener("click", function (event) {
        event.preventDefault();
        clearHistory();
        window.location.href = "viewprofile.html?brukernavn=" + hentInnloggetBrukerId();
    });

    let posts = [];
    let brukernavn = hentInnloggetBrukerId();
    let brukermeg = hentBruker(brukernavn);
    let following = brukermeg["following"];

    for (let i = 0; i < following.length; i++) {
        
        let followingbruker = hentBruker(following[i]);
        let tweets = followingbruker["posts"];
        console.log(tweets, followingbruker)
        for (let j = 0; j < tweets.length; j++) {
            let tweet = tweets[j];
            posts.push(tweet);
        }
        
        // // retweets også
        // let retweets = followingbruker["retweets"];
        // for (let j = 0; j < retweets.length; j++) {
        //     let retweet = retweets[j];
        //     posts.push(retweet);
        // }

        
    }

    posts.sort(function (a, b) {
        return b["posted"] - a["posted"];
    });

    let feed = document.querySelector("#feed");
    for (let i = 0; i < posts.length; i++) {
        let post = posts[i];
        let postElement = lagPostElement(post);
        feed.appendChild(postElement);
    }
    function formatTimestampPretty(a){
        // lag en funksjon som tar inn en timestamp og returnerer en string som er timestampen på en pen måte

        // hvis timestampen er mindre enn 1 minutt siden, returner "nå"
        // hvis timestampen er mindre enn 1 time siden, returner "n minutter siden"
        // hvis timestampen er mindre enn 1 dag siden, returner "n timer siden"
        // hvis timestampen er mindre enn 1 uke siden, returner "n dager siden"
        // hvis timestampen er mindre enn 1 måned siden, returner "n uker siden"
        // hvis timestampen er mindre enn 1 år siden, returner "n måneder siden"
        // ellers returner "n år siden"
        
        let now = Date.now();
        let diff = now - a;
        let diffSeconds = diff / 1000;
        let diffMinutes = diffSeconds / 60;
        let diffHours = diffMinutes / 60;
        let diffDays = diffHours / 24;
        let diffWeeks = diffDays / 7;
        let diffMonths = diffWeeks / 4;
        let diffYears = diffMonths / 12;

        if (diffSeconds < 60) {
            return "nå";
        }
        if (diffMinutes < 60) {
            return Math.floor(diffMinutes) + " minutter siden";
        }
        if (diffHours < 24) {
            return Math.floor(diffHours) + " timer siden";
        }
        if (diffDays < 7) {
            return Math.floor(diffDays) + " dager siden";
        }
        if (diffWeeks < 4) {
            return Math.floor(diffWeeks) + " uker siden";
        }
        if (diffMonths < 12) {
            return Math.floor(diffMonths) + " måneder siden";
        }
        return Math.floor(diffYears) + " år siden";

        


    }
    function lagPostElement(post) {

        let author = hentBruker(post["author"])
        let tweet = document.createElement("div");
        tweet.classList.add("tweet");

        let profilbildekolonne = document.createElement("div");
        profilbildekolonne.classList.add("profilbildekolonne");

        let profilbilde = document.createElement("img");
        profilbilde.classList.add("profilbilde");
        profilbilde.src = author["profileImage"];
        profilbilde.alt = "profilbilde";
        profilebilde.width = "50";
        profilebilde.height = "50";

        profilbildekolonne.appendChild(profilbilde);


        let tweetkolonne = document.createElement("div");
        tweetkolonne.classList.add("tweetkolonne");

        let forfatterinfo = document.createElement("div");
        forfatterinfo.classList.add("forfatterinfo");
        let div2 = document.createElement("div")
        div2.innerHTML = author["displayName"]
        let div3 = document.createElement("div")
        div3.innerHTML = "@"+post["author"]
        let div4 = document.createElement("div")
        div4.innerHTML = formatTimestampPretty(post["posted"])
        
        forfatterinfo.appendChild(div2)
        forfatterinfo.appendChild(div3)
        forfatterinfo.appendChild(div4)

        tweetkolonne.appendChild(forfatterinfo)

        let tweettekst = document.createElement("div")
        tweettekst.classList.add("tweettekst")
        tweettekst.innerHTML = post["text"]

        if (post["image"]) {
            let tweetbilde = document.createElement("img")
            tweetbilde.classList.add("tweetbilde")
            tweetbilde.src = post["image"]
            tweetbilde.alt = "tweet bilde"
            tweetkolonne.appendChild(tweetbilde)
        }
        let tweetknapper = document.createElement("div")
        tweetknapper.classList.add("tweetknapper")

        let kommentarknapp = document.createElement("button")
        kommentarknapp.classList.add("hiddenButton")
        kommentarknapp.classList.add("genericButton")
        kommentarknapp.classList.add("tweetknapp")
        kommentarknapp.classList.add("tweetknappkommentar")
        
        let mengdekommentarer = document.createElement("span")
        mengdekommentarer.innerHTML = post["comments"].length

        
        
        let kommentarikon = document.createElement("img")
        kommentarikon.src = "bilder/comment_hul.png"
        kommentarikon.alt = "kommentarikon"
        kommentarikon.height = "20"
        kommentarknapp.appendChild(kommentarikon)
        kommentarknapp.appendChild(mengdekommentarer)

        let retweetknapp = document.createElement("button")
        retweetknapp.classList.add("hiddenButton")
        retweetknapp.classList.add("genericButton")
        retweetknapp.classList.add("tweetknapp")
        retweetknapp.classList.add("tweetknappretweet")

        let mengderetweets = document.createElement("span")
        mengderetweets.innerHTML = post["retweets"].length

        let retweetikon = document.createElement("img")
        retweetikon.src = "bilder/retweet_hul.png"
        retweetikon.alt = "retweetikon"
        retweetikon.height = "20"

        retweetknapp.appendChild(retweetikon)
        retweetknapp.appendChild(mengderetweets)

        let likerknapp = document.createElement("button")
        likerknapp.classList.add("hiddenButton")
        likerknapp.classList.add("genericButton")
        likerknapp.classList.add("tweetknapp")
        likerknapp.classList.add("tweetknappliker")

        let mengdelikes = document.createElement("span")
        mengdelikes.innerHTML = post["likes"].length

        let likeikon = document.createElement("img")
        likeikon.src = "bilder/heart_hul.png"
        likeikon.alt = "likeikon"
        likeikon.height = "20"

        likerknapp.appendChild(likeikon)
        likerknapp.appendChild(mengdelikes)

        let viewknapp = document.createElement("button")
        viewknapp.classList.add("hiddenButton")
        viewknapp.classList.add("genericButton")
        viewknapp.classList.add("tweetknapp")
        viewknapp.classList.add("tweetknappview")

        let viewikon = document.createElement("img")
        viewikon.src = "bilder/eye_hul.png"
        viewikon.alt = "viewikon"
        viewikon.height = "20"

        let mengdeviews = document.createElement("span")
        mengdeviews.innerHTML = post["views"].length

        viewknapp.appendChild(viewikon)
        viewknapp.appendChild(mengdeviews)

        tweetknapper.appendChild(kommentarknapp)
        tweetknapper.appendChild(retweetknapp)
        tweetknapper.appendChild(likerknapp)
        tweetknapper.appendChild(viewknapp)

        tweetkolonne.appendChild(tweettekst)
        tweetkolonne.appendChild(tweetknapper)

        tweet.appendChild(profilbildekolonne)
        tweet.appendChild(tweetkolonne)

        return tweet;








      




    }








</script>

</html>